resource_types:
  - name: pypi
    type: docker-image
    source:
      repository: punkadiddle/concourse-pypi-resource
      tag: latest-rc

resources:
  - name: image
    type: docker-image
    icon: docker
    source:
      repository: petewall/platformio
      username: ((dockerhub-username))
      password: ((dockerhub-password))

  - name: package
    type: pypi
    icon: language-python
    source:
      name: platformio

  - name: source
    type: git
    icon: github
    source:
      uri: git@github.com:petewall/platformio-docker
      branch: master
      private_key: ((github-repo-key))

jobs:
  - name: build-image
    plan:
      - in_parallel:
        - get: package
          trigger: true
        - get: source
          trigger: true
      - put: image
        params:
          build: source
